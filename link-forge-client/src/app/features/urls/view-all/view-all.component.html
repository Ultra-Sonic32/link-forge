<div class="container">
  <div class="view-box">
    <h2 class="text-center text-white mb-4">All Shortened URLs</h2>
    <div class="d-flex justify-content-end mb-3">
      <button class="btn btn-primary" style="margin-right: 10px; width: 177px" (click)="refresh()">
        <i class="fa fa-refresh" aria-hidden="true"></i>
        Refresh
      </button>
    </div>

    <!-- Loading -->
    <div class="d-flex justify-content-center mb-3" *ngIf="isLoadingData()">
      <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="ms-2 mt-1 text-white">Loading URL data...</p>
    </div>

    <div *ngIf="!isLoadingData()">
      <!-- Search -->
      <input
        type="text"
        class="form-control text-white"
        placeholder="Search by any field..."
        [(ngModel)]="searchText"
        (ngModelChange)="onSearch()"
      />

      <!-- Items per page -->
      <label for="itemsPerPageSelect" class="text-white">Items per page:</label>
      <select
        id="itemsPerPageSelect"
        class="form-select mb-3 text-white"
        [ngModel]="itemsPerPage()"
        (ngModelChange)="onItemsPerPageChange($event)"
      >
        <option *ngFor="let option of itemsPerPageOptions" [value]="option">
          {{ option }}
        </option>
      </select>

      <!-- Table -->
      <div class="table-responsive view-table">
        <table class="table table-striped table-bordered text-center align-middle">
          <thead class="table-dark text-nowrap">
            <tr>
              <th>#</th>
              <th>Original URL</th>
              <th>Short URL</th>
              <th>Created</th>
              <th>Expires In</th>
              <th>Clicks</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let url of paginatedUrls(); let i = index">
              <td>{{ i + 1 }}</td>

              <td class="text-truncate" style="max-width: 200px" [title]="url.originalUrl">
                {{ url.originalUrl }}
              </td>

              <td>
                <a [href]="'http://localhost:3000/urls/resolve/' + url.shortUrl" target="_blank">
                  {{ url.shortUrl }}
                </a>
              </td>

              <td>{{ url.createdAt | date : "yyyy/MM/dd 'at' HH:mm" }}</td>

              <td>
                <span *ngIf="url.neverExpire">Never</span>
                <span *ngIf="!url.neverExpire"> {{ calculateDaysLeft(url.expiresAt) }} days </span>
              </td>

              <td>{{ url.clicks }}</td>

              <td>
                <span class="badge" [ngClass]="url.isActive ? 'bg-success' : 'bg-danger'">
                  {{ url.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>

              <td>
                <button
                  style="color: black"
                  class="btn btn-sm"
                  (click)="copyShortUrl(url.shortUrl)"
                >
                  <i class="fas fa-copy"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <app-pagination
        [currentPage]="currentPage()"
        [itemsPerPage]="itemsPerPage()"
        [totalItems]="searchedUrls().length"
        [itemsPerPageOptions]="itemsPerPageOptions"
        (pageChange)="goToPage($event)"
        (itemsPerPageChange)="onItemsPerPageChange($event)"
      ></app-pagination>

      <!-- No Results -->
      <div *ngIf="searchedUrls().length === 0" class="text-center mt-3 text-white">
        <p>No URLs found.</p>
      </div>
    </div>
  </div>
</div>
